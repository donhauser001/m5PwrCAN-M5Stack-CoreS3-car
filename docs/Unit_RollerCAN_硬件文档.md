# Unit RollerCAN 硬件文档

> 产品型号：U188 | 官方文档：https://docs.m5stack.com/zh_CN/unit/Unit-RollerCAN

---

## 1. 产品概述

**Unit RollerCAN** 是一款集成多项控制功能的无刷直流电机（BLDC）运动执行套件，专为高效运动控制设计。核心特性：

- **FOC 闭环驱动**：电流、速度、位置三环控制，磁编码器反馈
- **双通信方式**：CAN 总线 + I2C 总线
- **双供电方式**：XT30（6~16V）或 Grove（5V）
- **电滑环（可选）**：360° 无限旋转时保持顶部模块的供电与数据传输
- **板载 OLED + RGB + 按键**：实时状态显示与人机交互
- **软硬件完全开源**

---

## 2. 核心规格参数

| 规格                   | 参数                                                     |
| ---------------------- | -------------------------------------------------------- |
| MCU                    | STM32G431CBU6（Cortex-M4，170MHz，128KB Flash，32KB SRAM）|
| 电机类型               | D3504 200KV 无刷电机，直径 41mm                           |
| 驱动芯片               | DRV8311HRRWR                                             |
| 角度传感器             | TLI5012BE1000（磁编码器）                                 |
| 通讯接口               | 2× CAN（XT30 接口）+ 2× I2C（地址 0x64，Grove 接口）     |
| 显示屏                 | 0.66 寸 OLED，64×48 分辨率，SPI 通讯                      |
| RGB LED                | 2× WS2812-2020                                           |
| 噪音                   | 48dB                                                     |
| 工作温度               | 0~40°C                                                   |
| 产品尺寸               | 40.0 × 40.0 × 40.0mm                                    |
| 产品重量               | 84.6g                                                    |

---

## 3. 电机性能参数

### 3.1 电流限制

| 条件             | 最大相电流 |
| ---------------- | ---------- |
| 连续工作（无强制散热）| 0.5A      |
| 短时工作         | 1.0A       |

### 3.2 负载性能测试（DC 16V XT30 供电）

| 负载     | 电机转速   | 工作电流    | 备注         |
| -------- | ---------- | ----------- | ------------ |
| 空载     | —          | 78mA        |              |
| 50g      | 2100 rpm   | 225mA       |              |
| 200g     | 1400 rpm   | 601mA       |              |
| 500g     | 560 rpm    | 918mA       | **最大承重** |

### 3.3 输出扭矩

| 供电方式                | 扭矩                          | 电流    |
| ----------------------- | ----------------------------- | ------- |
| Grove 口 DC 5V          | 0.021 N·m（0.2 kgf·cm）       | 350mA   |
| CAN (XT30) DC 16V       | 0.065 N·m（0.66 kgf·cm）      | 927mA   |

### 3.4 待机电流

| 供电方式                | 待机电流 |
| ----------------------- | -------- |
| Grove 口 DC 5V          | 70mA     |
| CAN (XT30) DC 16V       | 32mA     |

---

## 4. 供电系统

### 4.1 供电方式

```
方式 1: CAN (XT30) 供电
┌─────────────────┐
│  6~16V DC 电源   │──── XT30 (2+2) ────► RollerCAN
└─────────────────┘     (电源 + CAN 信号)

方式 2: Grove 供电
┌─────────────────┐
│    5V DC 电源    │──── HY2.0-4P ──────► RollerCAN
└─────────────────┘     (电源 + I2C 信号)
```

> **注意**：供电不能超过 **16V**。电压超过 18V 后会触发过压保护，显示电机故障代码 `E:1`，屏幕显示 "Over Voltage"，LED 亮蓝灯，电机停止工作。

### 4.2 电滑环输出能力

| 参数             | 值             |
| ---------------- | -------------- |
| 集电环 Grove 输出 | DC 5V / 300mA |

电滑环版本可在 360° 旋转过程中，通过顶部 Grove 接口为额外模块供电并传输 I2C 数据。

---

## 5. 通信接口

### 5.1 接口一览

```
                  ┌─────────────────┐
    XT30 (CAN) ──┤  CAN 接口 ×2     │
                  │                 │
   Grove (I2C) ──┤  I2C 接口 ×2     │── HY2.0-4P
                  │  (地址: 0x64)   │
                  │                 │
     SWD/SWO  ──┤  调试接口        │── 1.25mm 5P
                  └─────────────────┘
```

### 5.2 CAN 接口（XT30）

- 接口类型：XT30 (2+2) PW-M
- 数量：2 个（菊花链拓扑，方便多设备串联）
- 同时承载 CAN 差分信号和 6~16V 电源（PwrCAN 总线）

### 5.3 I2C 接口（Grove）

| HY2.0-4P 线序 | 颜色  | 功能 |
| -------------- | ----- | ---- |
| Pin 1          | Black | GND  |
| Pin 2          | Red   | 5V   |
| Pin 3          | Yellow| SDA  |
| Pin 4          | White | SCL  |

- I2C 从机地址：**0x64**
- 数量：2 个（底部 + 顶部集电环）

### 5.4 SWD 调试接口

提供 1.25mm 5P 调试端子，支持 SWD 和 SWO 调试。

---

## 6. 引脚映射（STM32G431CBU6）

### 6.1 I2C / CAN / RGB / 按键

| STM32 引脚 | 功能          | 说明             |
| ---------- | ------------- | ---------------- |
| PA15       | SYS_I2C_SCL   | I2C 时钟         |
| PB7        | SYS_I2C_SDA   | I2C 数据         |
| PA11       | FDCAN_RX      | CAN 接收         |
| PA12       | FDCAN_TX      | CAN 发送         |
| PB4        | CAN_STB       | CAN 待机控制     |
| PB5        | LED_DAT       | WS2812 数据线    |
| PC6        | SYS_SW        | 功能按键         |

### 6.2 OLED 显示屏（SPI）

| STM32 引脚 | 功能       |
| ---------- | ---------- |
| PB15       | OLED_MOSI  |
| PB13       | OLED_SCK   |
| PB14       | OLED_DC    |
| PB11       | OLED_RST   |
| PB12       | OLED_CS    |

---

## 7. FOC 驱动系统

### 7.1 控制架构

```
                    ┌─────────────────────────────┐
                    │       STM32G431CBU6          │
                    │                              │
  CAN/I2C 指令 ──► │  ┌──────────────────────┐    │
                    │  │  三环 FOC 控制器       │    │
                    │  │                       │    │
                    │  │  电流环 ◄── 位置环     │    │    DRV8311
                    │  │    │         │        │    │──► (三相驱动) ──► D3504 电机
                    │  │    ▼         ▼        │    │
                    │  │  速度环 ◄─ 编码器反馈  │    │    TLI5012B
                    │  │              ▲        │    │◄── (磁编码器)
                    │  └──────────────┘        │    │
                    └─────────────────────────────┘
```

### 7.2 控制模式

| 模式         | 说明                                               |
| ------------ | -------------------------------------------------- |
| 电流模式     | 直接控制电机相电流                                 |
| 速度模式     | 闭环速度控制，通过编码器反馈                       |
| 位置模式     | 绝对位置控制，36000 pos = 360°                     |

> **编码器精度说明**：绝对位置模式下，编码器值 36000 对应 360°。由于机械安装角度与编码器角度不严格对应，实际可能存在约 **±2°** 误差。

### 7.3 关键芯片

| 芯片              | 型号            | 功能               |
| ----------------- | --------------- | ------------------ |
| MCU               | STM32G431CBU6   | 主控，运行 FOC 算法 |
| 电机驱动          | DRV8311HRRWR    | 三相 BLDC 驱动     |
| 角度传感器        | TLI5012BE1000   | 磁编码器，角度反馈 |

---

## 8. 通信协议概要

### 8.1 I2C 协议

- 从机地址：**0x64**
- 支持功能：电机控制、参数读写、状态查询
- 详细寄存器映射参见官方 [Unit RollerCAN-I2C Protocol](https://docs.m5stack.com/zh_CN/unit/Unit-RollerCAN) 文档

### 8.2 CAN 协议

- 通过 CAN 帧实现运动控制与参数调整
- 支持 CAN 2.0 标准帧/扩展帧
- 详细帧格式参见官方 [Unit RollerCAN-CAN Protocol](https://docs.m5stack.com/zh_CN/unit/Unit-RollerCAN) 文档

---

## 9. 与 CoreS3 + PwrCAN 模块配合

### 9.1 系统拓扑（小车场景）

```
┌──────────┐  M5-Bus  ┌──────────────┐  XT30 (PwrCAN)  ┌──────────────┐
│  CoreS3  │◄────────►│ Module13.2   │◄───────────────►│ RollerCAN #1 │
│  (主控)  │          │ PwrCAN       │                  │ (左轮电机)    │
└──────────┘          │              │  XT30 (PwrCAN)  ┌──────────────┐
                      │              │◄───────────────►│ RollerCAN #2 │
                      └──────┬───────┘                  │ (右轮电机)    │
                             │                          └──────────────┘
                        DC 9~24V
                        电源输入
```

### 9.2 连接说明

1. **CoreS3** 通过 M5-Bus 与 **Module13.2 PwrCAN** 堆叠
2. PwrCAN 模块通过 XT30 线缆连接多个 **RollerCAN** 电机单元（菊花链）
3. DC 电源（9~16V）从 PwrCAN 模块输入，同时为 CoreS3 和所有 RollerCAN 供电
4. CoreS3 通过 CAN 总线向各 RollerCAN 发送控制指令

### 9.3 供电电压选择

| 供电电压 | CoreS3 (via PwrCAN) | RollerCAN 电机扭矩 | 备注                    |
| -------- | -------------------- | ------------------- | ----------------------- |
| 9V       | ✅ 正常               | 较低                | PwrCAN 模块最低电压     |
| 12V      | ✅ 正常               | 中等                | **推荐**                |
| 16V      | ✅ 正常               | 最大（0.65 kgf·cm） | RollerCAN 最高电压      |
| >16V     | ✅ 正常               | ❌ 过压保护          | RollerCAN 不可超过 16V  |

> **重要**：PwrCAN 模块支持 9~24V，但 RollerCAN 最高只支持 **16V**。两者配合使用时，供电电压需限制在 **9~16V**。

---

## 10. 板载人机交互

| 组件           | 规格                     | 功能                 |
| -------------- | ------------------------ | -------------------- |
| OLED 显示屏    | 0.66 寸，64×48，SPI     | 实时显示设备状态     |
| RGB LED        | 2× WS2812-2020          | 状态指示             |
| 功能按键       | 1 个（PC6）              | 用户交互             |

### 状态指示灯含义

| LED 颜色 | 含义               |
| -------- | ------------------ |
| 蓝色     | 过压保护（>18V）   |

---

## 11. 机械安装

### 11.1 固定方式

- **LEGO 兼容孔位**：顶部与底座预留，支持乐高积木快速搭建
- **M3 螺丝孔**：标准 M3 螺丝固定，适合机器人结构集成

### 11.2 配套安装件

| 配件               | 数量 | 规格                |
| ------------------ | ---- | ------------------- |
| 法兰盘             | 1    | —                   |
| 支架               | 1    | —                   |
| 摩擦销             | 6    | LEGO 兼容           |
| M3 螺母            | 6    | —                   |
| 内六角杯头螺丝     | 2    | M3×14mm             |
| 内六角沉头螺丝     | 4+4  | M3×14mm + M3×12mm   |
| 六角扳手           | 2    | 2.5mm + 2mm         |

---

## 12. 开发资源

### 12.1 软件资源

| 资源                     | 说明                         |
| ------------------------ | ---------------------------- |
| Arduino 驱动库           | Unit RollerCAN Arduino 库    |
| UiFlow2 文档             | 图形化编程支持               |
| I2C 通信协议文档         | 寄存器映射与控制命令         |
| CAN 通信协议文档         | CAN 帧格式与控制命令         |
| I2C 用户手册             | 详细使用指南                 |
| CAN 用户手册             | 详细使用指南                 |
| 内置固件源码             | 完全开源                     |

### 12.2 硬件资源

| 资源                     | 说明                         |
| ------------------------ | ---------------------------- |
| 主板原理图               | Unit RollerCAN Main Board    |
| 顶部环板原理图           | Unit RollerCAN Top Ring Board|
| TLI5012BE1000 数据手册   | 角度传感器                   |
| DRV8311HRRWR 数据手册    | 电机驱动芯片                 |

---

## 13. 注意事项

1. **供电电压上限**：绝对不超过 **16V**（18V 以上触发过压保护，电机停止工作）。
2. **编码器误差**：绝对位置模式下存在约 ±2° 的机械安装误差。
3. **连续电流限制**：无强制散热时最大连续相电流 0.5A，短时可达 1.0A，长期超限可能导致过热。
4. **最大承重**：500g，超出可能导致电机堵转或过流。
5. **CAN 总线终端电阻**：菊花链末端设备需确认是否需要 120Ω 终端电阻（配合 PwrCAN 模块的拨码开关设置）。
6. **与 PwrCAN 配合的电压范围**：取两者交集 **9~16V**（PwrCAN 支持 9~24V，RollerCAN 支持 6~16V）。
7. **I2C 地址冲突**：多个 RollerCAN 通过 I2C 连接时注意地址冲突（默认均为 0x64），建议使用 CAN 总线连接多个电机。

---

## 14. 产品系列对比

| 特性           | RollerCAN      | RollerCAN Lite | Roller485      | Roller485 Lite |
| -------------- | -------------- | -------------- | -------------- | -------------- |
| 驱动芯片       | DRV8311        | DRV8311        | DRV8311        | DRV8311        |
| 通讯方式       | **CAN / I2C**  | **CAN / I2C**  | RS485 / I2C    | RS485 / I2C    |
| 集电环         | ✅ 有           | ❌ 无           | ✅ 有           | ❌ 无           |
| 电源指示 LED   | 蓝色           | 无             | 绿色           | 无             |
| 产品颜色       | 黑色           | 黑色           | 灰色           | 灰色           |

---

*文档版本：v1.0 | 创建日期：2026-02-13*
